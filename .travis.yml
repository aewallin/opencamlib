os:
  - linux
  - osx
  - windows

language: cpp

compiler:
    - gcc

env:
  - BUILD_CXX_LIB=ON BUILD_NODEJS_LIB=OFF BUILD_PY_LIB=OFF
  - BUILD_CXX_LIB=OFF BUILD_NODEJS_LIB=ON BUILD_PY_LIB=OFF
  - BUILD_CXX_LIB=OFF BUILD_NODEJS_LIB=OFF BUILD_PY_LIB=ON USE_PYTHONV3=OFF
  - BUILD_CXX_LIB=OFF BUILD_NODEJS_LIB=OFF BUILD_PY_LIB=ON USE_PYTHONV3=ON

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      if [[ "$PYTHONV" == "2" ]]; then
        HOMEBREW_NO_AUTO_UPDATE=1 brew install cmake boost-python;
      elif [[ "$PYTHONV" == "3" ]]; then
        HOMEBREW_NO_AUTO_UPDATE=1 brew install python boost-python3;
      fi;
      export CMAKE_FIND_FRAMEWORK=LAST;
      export CMAKE_VERBOSE_MAKEFILE=ON;
    elif [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
      sudo apt-get update;
      sudo apt-get install -y git libboost-python-dev libboost-system-dev;
      wget -O cmake.sh https://github.com/Kitware/CMake/releases/download/v3.13.2/cmake-3.13.2-Linux-x86_64.sh;
      sudo sh cmake.sh --skip-license --exclude-subdir --prefix=/usr/local;
    else
      choco install cmake;
      choco install boost-msvc-12;
    fi
before_script:
  - if [[ "$BUILD_NODEJS_LIB" == "ON" ]]; then npm install; fi
  - mkdir build
  - cd build
  - echo $BUILD_CXX_LIB
  - echo $BUILD_NODEJS_LIB
  - echo $BUILD_PY_LIB
  - echo $USE_PYTHONV3
  - cmake
        -DBUILD_CXX_LIB="$BUILD_CXX_LIB"
        -DBUILD_NODEJS_LIB="$BUILD_NODEJS_LIB"
        -DBUILD_PY_LIB="$BUILD_PY_LIB"
        -DUSE_PYTHONV3="$USE_PYTHONV3"
        ../src;
script: 
  - make

after_success:
  - sudo make install
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then otool -L /usr/local/lib/python2.7/site-packages/ocl.so; fi
